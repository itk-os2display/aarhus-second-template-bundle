/**
 * @name ItkAarhusSecondTemplateBundle
 * @version v1.0.0
 * @link https://github.com/itk-os2display/aarhus-second-template-bundle
 */
angular.module("aarhusSecondTemplates").directive("contactPicker",["mediaFactory","busService","$timeout",function(t,n,a){return{restrict:"E",replace:!0,scope:{slide:"=",close:"&",tool:"="},link:function(d){var c=null;function i(){var e=d.slide.media,i=Object.values(d.slide.options.contacts).reduce(function(e,i){return i.imageId&&(e[i.imageId]=i.id),e},{}),t=[];for(var n in e)if(e.hasOwnProperty(n)){var a=e[n],o=i[n];o&&(t.push(a),d.slide.options.contacts[o].imageId=t.indexOf(a))}d.slide.media=t}d.step=null,d.selectedMedia=[],d.selectedMediaType="image",d.slide.options.contacts||(d.slide.options.contacts={}),d.contactLength=function(){return Object.keys(d.slide.options.contacts).length},d.addContact=function(){if(!(6<=d.contactLength())){var e=Date.now();d.slide.options.contacts[e]={id:e,name:"",title:"",phone:"",email:""}}},d.removeContact=function(e){delete d.slide.options.contacts[e.id],i()},d.removeMedia=function(e){d.slide.options[e]=null,i()},d.backgroundPicker=function(e){c=e,d.step="background-picker"},d.pickFromMedia=function(){c&&""!==c.imageId&&null!==c.imageId&&void 0!==c.imageId&&(d.selectedMedia=[d.slide.media[c.imageId]]),d.step="pick-from-media"},d.pickFromComputer=function(){d.step="pick-from-computer"},d.back=function(){d.selectedMedia=[],d.step=null,c=null};d.$on("mediaOverview.selectMedia",function(e,i){!function(e){var i=[],t=!1,n=null;for(var a in d.slide.media)if(d.slide.media.hasOwnProperty(a)){var o=d.slide.media[a];o.id===e.id&&(t=!0,n=parseInt(a)),i.push(o)}t||(i.push(e),n=i.length-1),c.imageId=n,d.step=null,d.slide.media=i}(i)}),d.$on("mediaUpload.uploadSuccess",function(e,i){d.step=null,t.getMedia(i.id).then(function(e){a(function(){d.slide.media.push(e),c.imageId=d.slide.media.indexOf(e)})},function(e){n.$emit("log.error",{cause:e,msg:"Kunne ikke tilfÃ¸je media."})})})},templateUrl:"/bundles/itkaarhussecondtemplate/apps/aarhusSecondTemplates/contact-picker.html"}}]);